<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NYR Festas</title>
    <link rel="stylesheet" href="styles.css">
    <!-- <link rel="icon" type="image/png" href="/imagens/LOGO_NYR.png">-->

    <!--
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
-->
    <script src="config.js"></script>


</head>


<style>



    /* Para garantir que o estilo do botão de ícone tenha prioridade */
    .icon-button {
        background: none !important;
        /* Remove o fundo, se necessário */
        border: none !important;
        /* Remove a borda, se necessário */
        padding: 0 !important;
        /* Remove o preenchimento, se necessário */

    }


    .selected img {
filter: 
  drop-shadow(0 0 3px #ffb050)
  drop-shadow(0 0 3px #ffb050)
  drop-shadow(0 0 3px #ffb050);

    transition: filter 0.3s ease-in-out;
}









    .icon-wrapper {
        position: relative;
        display: inline-block;
    }

    .tooltip {
        position: absolute;
        bottom: 135%;
        /* Place above the image */
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
        padding: 5px 8px;
        border-radius: 4px;
        font-size: 0.85rem;
        visibility: hidden;
        opacity: 0;
        white-space: nowrap;
        transition: opacity 0.2s ease;
    }

    .icon-wrapper:hover .tooltip {
        visibility: visible;
        opacity: 1;
    }

    /* Estilo para o contêiner de ícones */
    .icons {
        position: fixed;
        top: calc(2rem + 87px);
        /* Ajuste para a altura desejada */
        right: 2rem;
        display: flex;
        gap: 0.9rem;
        align-items: center;
        z-index: 100;

    }

    /* Estilo para as imagens dos ícones */
    .icons img {
        width: 2.4rem;
        transition: transform 0.2s ease;
        cursor: pointer;
        position: relative;
        transition: transform 0.1s ease-in-out, background-color 0.3s;

    }

    /* Efeito de zoom ao passar o mouse sobre o ícone */
    .icons img:hover {
        transform: scale(1.3);
    }

    .icons img:active {
        transform: scale(0.98);
        /* Shrinks button slightly */
        /*box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);*/
        filter: drop-shadow(5px 5px 10px rgba(0, 0, 0, 0.5));
    }




    .modal-buttons button {
        background-color: #BF6734;
        /* Dark orange button color */
        color: #fff;
        padding: 10px;
        /* More space */
        margin-top: 10px;
        border: none;
        border-radius: 10px;
        /* Rounded corners */
        cursor: pointer;
        width: 100%;
        font-size: 1em;
        /* Larger font */
        font-weight: 600;
        /* Bold */
        transition: transform 0.1s ease-in-out, background-color 0.3s;
    }

    .modal-buttons button:hover {
        background-color: #e2943a;
        /* Light yellow-orange hover color */
        transform: scale(1.03);
        /* Efeito de aumento ao passar o mouse */
    }

    .modal-buttons button:active {
        transform: scale(0.98);
        /* Shrinks button slightly */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        background-color: #a35c33;
        /* Darker shade */
    }


    #download {
        display: flex;
        align-items: center;
        /* Centers content vertically */
        justify-content: space-between;
        /* Keeps title and button spaced */
        max-width: 95%;
        background-color: #e7e5e5;
        border-radius: 8px;
        border: 1px solid #ccc;
        margin: 2px auto;
        /*padding: 10px 20px; /* Adjusted padding for better centering */

        padding-bottom: 10px;
        padding-left: 20px;
        padding-right: 20px;

        height: 60px;
        /* Ensure enough height */
    }

    /*

#download {
        display: flex;
        align-items: center; 
        max-width: 95%;
        background-color: #e7e5e5;
        border-radius: 8px;
        border: 1px solid #ccc;
        margin: 2px auto;
        padding: 33px;
        max-height: 45px;
    }
*/

    #lista {
        margin: 0;
    }


    #downloadButton {
        display: flex;
        align-items: center;
        justify-content: center;
        max-width: 160px;
        /* Reduced width */
        padding: 8px 12px;
        /* Adjusted padding */
        background-color: #4CAF50;
        color: white;
        border-radius: 10px;
        font-size: 16px;
        text-align: center;
        border: none;
        cursor: pointer;
        margin-left: auto;
        flex-wrap: nowrap;
        /* Prevents excessive stretching */
    }

    /*
#downloadButton {
    display: flex;
    align-items: center; 
    justify-content: center;
    max-width: 230px;
    padding: 10px 10px;
    background-color: #4CAF50;
    color: white;
    border-radius: 10px;
    font-size: 16px;
    text-align: center;
    border: none;
    cursor: pointer;
    position: relative;
    margin-left: auto;  
}
*/
    /* Style the image inside the button */
    .button-icon {
        width: 20px;
        /* Adjust the width of the image */
        height: 20px;
        /* Adjust the height of the image */
        margin-right: 11px;
        /* Space between the image and text */
    }

    /* Spinner animation */
    .spinner {
        border: 2px solid #f3f3f3;
        border-top: 2px solid #3498db;
        border-radius: 50%;
        width: 16px;
        height: 16px;
        animation: spin 1s linear infinite;
        margin-right: 10px;
        display: none;
    }

    /* Spinner keyframes */
    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    /* Hidden text opacity during spinner animation */
    .buttonTextHidden {
        opacity: 0.5;
    }







    #produto a {

        text-decoration: none;
        font-weight: bold;
        border-radius: 25px;
        padding: 6px 25px;
        background-color: #BF6734;
        border-radius: 25px;
    }



    #qtd-estoque {
    display: flex;
    gap: 20px; /* Adds space between the divs */
}



.stock-control {
    margin-top: 10px; /* Keeps your original margin */
}


/*
.quantity {
    width: 100px; 
}*/




    /* Modal Styles - Improvement */
    .modal {
        display: none;
        position: fixed;
        z-index: 10000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        overflow: hidden;
    }

    /* Modal Content - Improvement */
    .modal-content {
        position: relative;
        background-color: #fff;
        margin: 10vh auto;
        padding: 25px;
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        overflow-y: auto; /* Enable vertical scrolling if needed */
    }

    /* Close Button - Repositioned */
    #closeModalBtn {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 24px;
        font-weight: bold;
        color: #aaa;
        cursor: pointer;
        background: none;
        border: none;
        width: auto;
        height: auto;
        z-index: 1001;
    }

    #closeModalBtn:hover {
        color: #BF6734;
    }

    /* Modal Stage One */
    .modal-stage-one {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    /* Product Image Container */
    .prodimage {
        text-align: center;
        margin-bottom: 15px;
    }

    .prodimage img {
        max-width: 100%;
        max-height: 200px;
        object-fit: contain;
        border-radius: 8px;
    }

    /* Product Info Styling */
    .product-info, .price1-info, .price2-info, .cxfechada-info, .cxfracionada-info {
        padding: 8px 0;
        border-bottom: 1px solid #eee;
        z-index: 1000;
    }

    /* Quantity and Stock Controls */
    #qtd-estoque {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 15px;
        margin: 15px 0;
    }

    .quantity {
        flex: 1;
        min-width: 120px;
    }

    .quantity input {
        width: 100%;
        padding: 10px;
        border: 1px solid #BF6734;
        border-radius: 8px;
        font-size: 1.2rem;
    }

    .stock-control {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 0;
    }

    /* Modal Buttons */
    .modal-buttons {
        margin-top: 20px;
    }

    .modal-buttons button {
        margin-top: 10px;
        padding: 12px;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .modal-content {
            width: 95%;
            margin: auto;
            padding: 15px;
            max-height: 100vh;
        }

        #qtd-estoque {
            flex-direction: column;
            align-items: flex-start;
        }

        .quantity {
            width: 100%;
        }

        .stock-control {
            width: 100%;
            margin-top: 10px;
        }
    }

    @media (max-width: 480px) {
        .modal-content {
            padding: 10px;
            margin: 2vh auto;
        }

        #codprod {
            font-size: 1.2rem;
        }

        #descrip, #preco1, #preco2, #CxFechada, #CxFracionada {
            font-size: 1rem;
        }

        .quantity input {
            font-size: 1rem;
        }
    }

    /* Expanded Image Modal */
    .expanded-modal {
        display: none;
        position: fixed;
        z-index: 10001;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        overflow: hidden;
    }

    .expanded-modal-content {
        position: relative;
        margin: auto;
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .expanded-image-container img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        border-radius: 8px;
        transition: transform 0.3s ease;
    }

    .expanded-image-container img:hover {
        transform: scale(2);

    }

    .close-expanded {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 24px;
        font-weight: bold;
        color: #fff;
        cursor: pointer;
        background: none;
        border: none;
        z-index: 10002;
    }

    .close-expanded:hover {
        color: #BF6734;
    }

    /* Image container styling */
    .image-container {
        position: relative;
        display: flex;
        justify-content: center;
        margin-bottom: 15px;
        overflow: visible;
    }

    .prodimage {
        text-align: center;
        width: 100%;
        height: auto;
        max-height: 250px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .prodimage img {
        max-width: 100%;
        max-height: 250px;
        object-fit: contain;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.3s ease;
    }

    /* Expand image button */
    .expand-button {
        position: absolute;
        bottom: 8px;
        right: 8px;
        background: rgba(0, 0, 0, 0.5);
        color: white;
        border: none;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 1002;
        transition: background 0.3s ease;
    }

    .expand-button:hover {
        background: rgba(191, 103, 52, 0.8);
    }

    /* Expanded Image Modal */
    .expanded-modal {
        display: none;
        position: fixed;
        z-index: 10001;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.85);
        overflow: hidden;
    }

    .expanded-modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 90vw;
        height: 90vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .expanded-image-container {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .expanded-image-container img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
    }

    .close-expanded {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
        color: #fff;
        cursor: pointer;
        background: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10002;
    }

    .close-expanded:hover {
        background: rgba(191, 103, 52, 0.8);
    }

    /* Image zoom and pan */
    .expanded-image-container {
        overflow: hidden;
    }

</style>

<body>


    <header>
        <h1 id="nyrfestas"></h1>

        <div id="user-info">
            <span id="username-display"></span>
            <button id="logoutBtn">Sair</button>
        </div>

        <div class="logoNyr">
            <img id="logo" src="/imagens/LOGO.png" alt="LOGO">
        </div>

    </header>

    <nav>
        <div id="customerSelected">

            <span id="customerName">...</span>
            <span class="clear-btn" onclick="clearCustomer()">❌</span>
        </div>


        <ul>
            <li id="cadastro-link"><a href="#">Cadastro</a></li>
            <li id="produto"><a href="produtos.html">Lista de Produtos</a></li>
            <li id="pedidos-link"><a href="#">Pedidos</a></li>
        </ul>

    </nav>





    <div class="icons">
        <div class="icon-wrapper">
            <button id="carnaval" class="icon-button" aria-label="Filtrar produtos de Carnaval">
                <img src="/imagens/carnaval.png" alt="Festas">
                <span class="tooltip">Festas</span>
            </button>
        </div>
        <div class="icon-wrapper">
            <button id="junino" class="icon-button" aria-label="Filtrar produtos Juninos">
                <img src="/imagens/junino1.png" alt="Junino">
                <span class="tooltip">Junino</span>
            </button>
        </div>
        <div class="icon-wrapper">
            <button id="hlwn" class="icon-button" aria-label="Filtrar produtos de Halloween">
                <img src="/imagens/halloween.png" alt="Halloween">
                <span class="tooltip">Halloween</span>
            </button>
        </div>
    </div>



    <div class="PAGE">












        <div id="download">

            <h1 id="lista">Lista de Produtos</h1>






            <button id="downloadButton" class="button">
                <span id="spinner" class="spinner" style="display: none;"></span>
                <img src="/imagens/download.png" alt="icon" class="button-icon">
                <span id="buttonText">Catálogo!</span>
            </button>



            <!-- Hidden download link -->
            <a id="downloadLink" href="https://drive.google.com/uc?export=download&id=1zJ7tXB5U_Y-Ck_DiU_G7y65ikX0G6a9b" download
                style="display: none;"></a>

                


        </div>


        <!-- Search Wrapper -->
        <div class="search-wrapper">
            <input type="text" id="searchInput" placeholder=" Buscar por cód. ou descrição do produto..." oninput="searchProducts()">                            
        </div>

        <div class="produtos-moldura">
            <table id="productTable">
                <thead>
                    <tr>
                        <th class="itemHeader">Item</th>
                        <th>Foto do produto</th>
                        <th>Código do produto</th>
                        <th>Descrição do produto</th>
                        <th class="qtdFechadaHeader">Quantidade cx fechada</th>
                        <th>Preço de cx fechada</th>
                        <th class="qtdFracionadaHeader">Quantidade cx fracionada</th>
                        <th>Preço cx fracionada</th>
                        <th>Adicionar ao pedido</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Product rows will be dynamically inserted here -->
                </tbody>
            </table>
        </div>






        <!-- Modal -->
        <div id="myModal" class="modal">
            <div class="modal-content">
                <span class="close" id="closeModalBtn">×</span>

                <div class="modal-stage-one">
                    <div class="image-container">
                        <div class="prodimage">
                            <img src="https://placehold.co/150" alt="Product Image" id="prodImage">
                        </div>
                    </div>

                    <div class="product-info">
                        <h3 id="codprod"></h3>
                        <p id="descrip"></p>
                    </div>

                    <div class="price1-info">
                        <p id="preco1"><strong></strong></p>
                    </div>

                    <div class="price2-info">
                        <p id="preco2"><strong></strong></p>
                    </div>

                    <div class="cxfechada-info">
                        <p id="CxFechada"><strong></strong></p>
                    </div>

                    <div class="cxfracionada-info">
                        <p id="CxFracionada"><strong></strong></p>
                    </div>

                    <div class="modal-buttons">
                        <div id="qtd-estoque">
                            <div class="quantity">
                                <input type="number" id="quantity" name="quantity" min="1" value="" placeholder="Quantidade">
                            </div>

                            <!-- Stock Checkbox (hidden by default) -->
                            <div id="chkbxestoque" class="stock-control" style="display: none;">
                                <input type="checkbox" id="stockCheckbox" name="stockCheckbox">
                                <label for="stockCheckbox">Em Estoque</label>
                            </div>
                        </div>

                        <button id="addButton">Adicionar</button>
                        <button id="cancelButton">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Expanded Image Modal -->
        <div id="expandedImageModal" class="expanded-modal">
            <div class="expanded-modal-content">
                <span class="close-expanded" id="closeExpandedBtn">×</span>
                <div class="expanded-image-container">
                    <img src="" id="expandedImage" alt="Imagem ampliada do produto">
                </div>
            </div>
        </div>

    </div>

    <script>

        ////////////////////////////////////////////////////////////////////////////////////////////

        // Handle login status
        const username = localStorage.getItem('username');
        if (username) {
            document.getElementById('username-display').textContent = `Bem vindo, ${username}`;
        } else {
            alert("Você precisa estar logado para acessar esta página!");
            window.location.href = '/';
        }

        ////////////////////////////////////////////////////////////////////////////////////////////

        // Logout function
        document.getElementById('logoutBtn').addEventListener('click', function () {
            localStorage.removeItem('username');  // Remove login data
            window.location.href = '/';  // Redirect to login page
        });


        ////////////////////////////////////////////////////////////////////////////////////////////



        // Fetch the user's role from localStorage
        const userRole = localStorage.getItem('role'); // Ensure this is set at login
        const pedidosLink = document.getElementById('pedidos-link').querySelector('a');
        const cadastroLink = document.getElementById('cadastro-link').querySelector('a');


        // Dynamically assign the correct href based on the user's role
        if (userRole === 'USER') {
            pedidosLink.href = 'pedidos.html';
            cadastroLink.href = 'CADASTRO/CADASTRO_USER/cadastro.html';
        } else if (userRole === 'SELLER') {
            pedidosLink.href = 'pedidosrep.html';
            cadastroLink.href = 'CADASTRO/CADASTRO_REP/cadastrorep.html';
        } else if (userRole === 'ADMIN') {
            pedidosLink.href = 'pedidosadmin.html';
            cadastroLink.href = 'CADASTRO/CADASTRO_ADMIN/cadastroadmin.html';
        } else {
            pedidosLink.href = '#'; // Default action for unknown or missing roles
            console.warn('Role not defined or invalid.');
        }



        /*
        // Dynamically assign the correct href based on the user's role
        if (userRole === 'USER') {
          pedidosLink.href = 'pedidos.html';
          cadastroLink.href = 'cadastro.html';
        } else if (userRole === 'SELLER') {
          pedidosLink.href = 'pedidosrep.html';
          cadastroLink.href = 'cadastrorep.html';
        } else if (userRole === 'ADMIN') {
          pedidosLink.href = 'pedidosadmin.html';
          cadastroLink.href = 'cadastroadmin.html';
        } else {
          pedidosLink.href = '#'; // Default action for unknown or missing roles
          console.warn('Role not defined or invalid.');
        }
      */

        ////////////////////////////////////////////////////////////////////////////////////////////


        // Function to load customer name based on customerId in localStorage
        function loadCustomerName() {
            const customerId = localStorage.getItem('customerId');
            console.log(customerId);

            if (!customerId) {
                console.error('Customer ID not found in localStorage!');
                document.getElementById('customerName').textContent = 'Nenhum cliente selecionado';
                return;
            }

            // Fetch customer name from backend (sending customerId in the request body)
            fetch(`${URL_API}/displayName`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ customerId }) // Sending customerId in the request body
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // Display customer name from backend
                    const customerName = data.razaosocial || 'Unknown';
                    document.getElementById('customerName').textContent = `Cliente: ${customerName}`;
                })
                .catch(error => {
                    console.error('Error fetching customer name:', error);
                    document.getElementById('customerName').textContent = 'SELECIONE UM CLIENTE E TENTE NOVAMENTE.';
                });
        }

        // Function to clear the customer selection
        function clearCustomer() {
            localStorage.removeItem('customerId');
            document.getElementById('customerName').textContent = 'Nenhum cliente selecionado';
        }

        // Call the function when the page loads
        loadCustomerName();


        ////////////////////////////////////////////////////////////////////////////////////////////
        document.getElementById('downloadButton').addEventListener('click', function () {
            // Get elements
            const button = document.getElementById('downloadButton');
            const spinner = document.getElementById('spinner');
            const buttonText = document.getElementById('buttonText');
            const downloadLink = document.getElementById('downloadLink');

            // Show the spinner and reduce text opacity immediately
            spinner.style.display = 'inline-block';
            buttonText.classList.add('buttonTextHidden');

            // Trigger the download immediately
            downloadLink.click();

            // You can simulate any task if you want the spinner to stay visible for a duration.
            setTimeout(() => {
                // Hide the spinner and restore text opacity after 5 seconds or the task duration
                spinner.style.display = 'none';
                buttonText.classList.remove('buttonTextHidden');
            }, 4000); // Adjust this delay as needed
        });

        /*
        document.getElementById('downloadButton').addEventListener('click', function() {
                // Get elements
                const button = document.getElementById('downloadButton');
                const spinner = document.getElementById('spinner');
                const buttonText = document.getElementById('buttonText');
                const downloadLink = document.getElementById('downloadLink');
                
                // Show the spinner and reduce text opacity
                spinner.style.display = 'inline-block';
                buttonText.classList.add('buttonTextHidden');
                
                // Simulate a task (e.g., API call or download) with a timeout
                const startTime = Date.now();
                
                setTimeout(() => {
                    // Simulating task duration (5 seconds)
                    const endTime = Date.now();
                    const duration = endTime - startTime;
                    
                    // Log the task duration
                    console.log(`Task completed in ${duration}ms`);
        
                    // Hide the spinner and restore text opacity
                    spinner.style.display = 'none';
                    buttonText.classList.remove('buttonTextHidden');
                    
                    // Trigger the download after the task finishes
                    downloadLink.click();
                },10); // Simulating a 5-second task
            });*/

        // Expanded Image Modal
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('myModal');
            const expandedModal = document.getElementById('expandedImageModal');
            const closeExpandedBtn = document.getElementById('closeExpandedBtn');
            const prodImage = document.getElementById('prodImage');
            const expandedImage = document.getElementById('expandedImage');
            
            // Permitir que o clique na imagem também abra o modal expandido
            prodImage.addEventListener('click', function() {
                const imageUrl = this.src;
                expandedImage.src = imageUrl;
                expandedModal.style.display = 'block';
            });
            
            // Fechar modal de imagem expandida
            closeExpandedBtn.addEventListener('click', function() {
                expandedModal.style.display = 'none';
            });
            
            // Fechar quando clicar fora do modal
            window.addEventListener('click', function(event) {
                if (event.target === expandedModal) {
                    expandedModal.style.display = 'none';
                }
            });
            
            // Tecla ESC fecha o modal
            window.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && expandedModal.style.display === 'block') {
                    expandedModal.style.display = 'none';
                }
            });
        });

    </script>
    <script src="script.js"></script>
    <footer>
        <p>&copy; 2025 | NYR Festas</p>
    </footer>
</body>

</html>