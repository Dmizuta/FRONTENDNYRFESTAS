<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NYR Festas (A)</title>
    <link rel="stylesheet" href="styles.css">
    <script src="scripts/loadComponents.js" defer></script>
    <link rel="icon" type="image/png" href="/imagens/LOGO_NYR.png">
    <script src="config.js"></script>
</head>

<style>
    .allbtns {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px; /* Adds space between buttons */
       
    }
    
    .modal-actions {
        display: flex;
        justify-content: center;
        gap: 20px; /* Space between buttons */
        flex-wrap: wrap; /* Allow buttons to wrap on smaller screens */
    }
    
    .action-btn {
        padding: 12px 25px;
        font-size: 1.2rem;
        font-weight: 500;
        border: 2px solid transparent; /* Default border */
        border-radius: 8px; /* Soft rounded corners */
        cursor: pointer;
        transition: all 0.3s ease;
        width: 160px; /* Uniform width */
        text-transform: uppercase; /* Uppercase for consistency */
        background-color: #007bff; /* Main blue color */
        color: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Soft shadow for depth */
    }
    
    .action-btn:hover {
        background-color: #0069d9; /* Darker blue on hover */
        border-color: #0056b3; /* Darker border for contrast */
        box-shadow: 0 6px 10px rgba(0, 0, 0, 0.2); /* Deeper shadow on hover */
    }
    
    .action-btn:active {
        transform: scale(0.98); /* Slight shrink on click */
        background-color: #0056b3; /* Even darker blue when clicked */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Reduced shadow on click */
    }
    
    #close-modal {
        background-color: #f8f9fa; /* Light grey for "Fechar" */
        color: #333; /* Dark text */
        border: 2px solid #ccc; /* Light grey border */
        font-size: 1.2rem; /* Smaller text for close button */
        padding: 8px 18px; /* Smaller padding */
        width: 120px; /* Smaller width */
        box-shadow: none; /* No shadow for close button */
    }
    
    #close-modal:hover {
        background-color: #e2e6ea; /* Light grey on hover */
        border-color: #ddd; /* Slightly darker border on hover */
    }
    
    /* Orders container */
    #orders-container {
        max-width: 95%;
        margin: 30px auto;
        padding: 20px;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .order-row {
    display: grid;
    grid-template-columns: 0.5fr 2fr 3fr 1fr 1fr 0.8fr;
    gap: 10px;
    align-items: center;
    padding: 15px;
    border-bottom: 1px solid #ddd;
    margin-bottom: 10px;
    background-color: #f9f9f9;
    border-radius: 5px;
    font-size: 1.25rem;
    cursor: pointer;
}

   
    
    .order-details {
        display: flex;
        flex: 1;
        justify-content: space-between;
    }
    
    .order-details div {
        margin: 0 10px;
        color: #333;
    }
    
    /* Status styling */
    .status {
        font-weight: bold;
        color: #007BFF;
    }
    
    .order-row:hover {
        background-color: #eef2f5;
    }
    
    /* Responsive layout for mobile */
    @media (max-width: 768px) {
        .order-row {
            flex-direction: column;
            align-items: flex-start;
        }
        .order-details {
            flex-direction: column;
        }
    }
    
    /* Modal Styling */
    .modal {
        display: none;
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
        padding: 60px 20px; /* Add padding to prevent content from touching edges */
        font-size: 1rem;
    }
    
    .modal-content {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        width: 90%;
        max-width: 1300px;
        max-height: 90vh; /* Limit height to 80% of viewport */
        overflow-y: auto; /* Enable vertical scrolling */
        animation: fadeIn 0.3s ease-in-out;
        margin: auto; /* Center modal on screen */
    }
    
    #logo-image {
        width: 20%;
        padding: 10px;
    }
    
    #order-details-content {
        padding: 10px;
        text-align: center;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .order-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 1.2rem;
    }
    
    .order-info {
        flex: 1;
    }
    
    .order-info-row {
        margin: 5px 0;
    }
    
    /* Modal table styling */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    
    table th, table td {
        padding: 8px;
        text-align: center;
        border: 1px solid #ddd;
    }
    
    #order-items-body tr:nth-child(even) {
        background-color: #f9f9f9;
    }

    #total-order {
        font-weight: bold; 
        float: right;
        color: white;
    }

    #total-value {
        font-weight: bolder;
        float: right;
        color: white;
    }

    #discount-value {
        font-weight: bold;
        float: right;
        color: rgb(245, 158, 158);
    }
    
    #ipi-order {
        font-weight: bold;
        float: right;
        color: rgb(255, 255, 199);
    }

    /* When modal is open, make it visible */
    .modal.show {
        display: flex;
    }
    
    .totalOrderBox {
        padding: 20px 20px;
        margin: 20px auto;
        background-color: #13273d;
        color: white;
        border: none;
        border-radius: 5px;
    }
    
    /* Responsiveness for smaller screens */
    @media (max-width: 768px) {
        .order-header {
            flex-direction: column;
        }
        .order-info {
            margin-top: 20px;
        }
    }
    
    .obs-row {
        padding: 10px;
        background-color: #aaa;
        border-radius: 10px;
        font-size: 1.2rem;
    }
    
    textarea {
        width: 100%;
        padding: 10px;
        font-size: 1.3rem;
        border-radius: 4px;
        border: 1px solid #ccc;
        box-sizing: border-box;
        resize: none;
        line-height: 24px; /* Set line height to calculate row height */
        max-height: 120px; /* Limit to 3 rows (3 * 24px) */
        overflow-y: auto; /* Enable scrolling when the content exceeds max height */
    }
    
    /* Base styles for both buttons */
    .modalOrderDeleteButton, .modalOrderEditButton {
        width: 40px;                /* Set desired width */
        height: 40px;               /* Set desired height */
        cursor: pointer;           /* Indicate the buttons are clickable */
        transition: transform 0.3s ease, box-shadow 0.3s ease; /* Smooth transition for transform and shadow */
    }
    
    .modalOrderEditButton img, .modalOrderDeleteButton img {
        vertical-align: super;     /* Align image properly */
        width: 20px;                /* Set image size */
        height: auto;               /* Keep aspect ratio */
    }
    
    /* Hover state for both buttons */
    .modalOrderDeleteButton:hover, .modalOrderEditButton:hover {
        transform: scale(1.1);  /* Slightly grow the button on hover */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Add a soft shadow for depth */
    }
    
    /* Optional: active state to shrink the button slightly when clicked */
    .modalOrderDeleteButton:active, .modalOrderEditButton:active {
        transform: scale(0.98);  /* Shrink the button a bit when clicked */
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Lighter shadow on active state */
    }
    
    .save-quantity-btn {
        background-color: #28a745;
        width: 5rem;
        display: block; 
        margin: 0.5rem auto 0; /* Top margin, center alignment, no bottom margin */
    }
    .save-quantity-btn:hover {
        background-color: #6aa277; /* Yellow-orange hover color */
        transform: scale(1.03); /* Aumenta o tamanho do elemento em 10% */
    }
    
    .edit-quantity {
        padding: 10px;
        font-size: 1.3rem;
        border: 2px solid #007BFF; /* Optional: blue border */
        border-radius: 8px;
        width: 5rem; /* Adjust width if necessary */
        text-align: center;
    }
    
    .order-total {
        font-size: 1.3rem;
    }
    
    .valores {
        color: white;
        font-size: 1.3rem;
        font-weight: bold;
    }
    
    .container {
        display: flex;
        flex-direction: column;
        align-items: self-start;
        gap: 10px;
        font-family: Arial, sans-serif;
    }
    
    /* Flexbox layout for labels and switch */
    .switch-container {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .switch-label {
        font-size: 1.3rem;
        font-weight: bold;
        transition: color 0.3s;
    }
    
    /* Style for the toggle switch */
    .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }
    
    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    
    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #4CAF50;
        transition: 0.4s;
        border-radius: 34px;
    }
    
    .slider:before {
        position: absolute;
        content: "";
        height: 26px;
        width: 26px;    
        border-radius: 50%;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
    }
    
    input:checked + .slider {
        background-color: #ccc;
    }
    
    input:checked + .slider:before {
        transform: translateX(26px);
    }
    
    /* Style for the dropdown container */
    .dropdown {
        margin: 20px 0;
        font-family: Arial, sans-serif;
    }
    
    /* Style for the label */
    .dropdown label {
        font-size: 1.2rem;
        font-weight: bold;
        color: #333;
        display: block;
        margin-bottom: 5px;
    }
    
    /* Style for the select dropdown */
    #ipi {
        width: 100%;
        padding: 8px;
        font-size: 1.2rem;
        color: #333;
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 5px;
        outline: none;
        transition: border-color 0.3s ease;
    }
    
    /* Focus effect for the select input */
    #ipi:focus {
        border-color: #BF6734;
    }
    
    /* Style for the options inside the dropdown */
    #ipi option {
        padding: 10px;
        background-color: #fff;
    }
    
    /* Hover effect for the dropdown */
    #ipi:hover {
        border-color: #BF6734;
    }
    
    /* Style for the select box container when it's not focused */
    .dropdown {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        width: 100px;
        margin: 20px 0;
        padding-right: 30px;
    }
    
    /* By default, hide the print-only span*/ 
    .ipi-print-only {
        display: none;
    }
    
    /* Style for the select dropdown */
    #desc {
        width: 100%;
        padding: 8px;
        font-size: 1.2rem;
        color: #333;
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 5px;
        outline: none;
        transition: border-color 0.3s ease;
    }
    
    /* Focus effect for the select input */
    #desc:focus {
        border-color: #BF6734;
    }
    
    /* Style for the options inside the dropdown */
    #desc option {
        padding: 10px;
        background-color: #fff;
    }
    
    /* Hover effect for the dropdown */
    #desc:hover {
        border-color: #BF6734;
    }
    
    .desc-print-only {
        display: none;
    }
    
    .topButtons {
        display: flex;        /* Enables flexbox */
        justify-content: space-between; /* Distributes space between the two divs */
        align-items: center;  /* Aligns items vertically in the center */
        gap: 10px;            /* Adds space between the two divs (optional) */
    }
    
    .topButtons > div {
        flex: 1; /* Makes both divs take equal space */
    }
    
    #pedido-adm a {
        text-decoration: none;
        font-weight: bold;
        border-radius: 25px;
        padding: 6px 25px;
        background-color: #BF6734;
        border-radius: 25px;
    }
    










    #control-panel {
    max-width: 95%;  
    margin: 0 auto; /* <- This line centers it horizontally */
    
    padding: 20px;
    background-color: #f9f9f9;
    border-radius: 12px;
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.08);
    display: flex;
    flex-wrap: wrap;
    align-items: flex-end;
    justify-content: space-between;
    gap: 20px;
}

#control-panel h3 {
    flex-basis: 100%;
    font-size: 1.3rem;
    color: #333;
    margin-bottom: 10px;
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

#searchInput,
#status-filter {
    padding: 8px 12px;
    width: 220px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1.3rem;
}

#order-sum {
    font-weight: bold;
    font-size: 1.3rem;
    color: #007BFF;
}

#uploadForm {
    display: flex;
    flex-direction: column;
    gap: 8px;
}


#uploadForm input[type="file"] {
    font-size: 1rem;
    border: none;
}

#uploadForm button {
    background-color: #28a745;
    color: white;
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s ease;
}

#uploadForm button:hover {
    background-color: #218838;
}

</style>

<body>
<header>
    <h1 id="nyrfestas"></h1>
    <div id="user-info">
        <span id="username-display"></span>
        <button id="logoutBtn" aria-label="Logout do usuário">Sair</button>
    </div>
    <div class="logoNyr">
        <img id="logo" src="/imagens/LOGO.png" alt="LOGO">
    </div>
</header>

<nav>
    <div id="customerSelected">
        <span id="customerName">...</span>
        <span class="clear-btn" onclick="clearCustomer()">❌</span>
    </div>
    <ul>
        <li><a href="CADASTRO/CADASTRO_ADMIN/cadastroadmin.html">Cadastro</a></li>
        <li><a href="produtos.html">Lista de Produtos</a></li>
        <li id="pedido-adm"><a href="pedidosadmin.html">Pedidos</a></li>
    </ul>
</nav>

<div class="PAGE">
    <h1>PEDIDOS (Admin)</h1>
    <div class="box">
        <!-- New Control Panel -->
        <div id="control-panel">
            <h3>Controle de Pedidos</h3>
            <div class="filter-group">
                <label for="searchInput">Pesquisar:</label>
                <input type="text" id="searchInput" placeholder="Buscar por ID, vendedor, razão social...">
                
            </div>
            <div class="filter-group">
                <label for="status-filter">Status:</label>
                <select id="status-filter">
                    <option value="all">Todos</option>
                    <option value="0">Aberto</option>
                    <option value="1">Orçamento</option>
                    <option value="2">Fechado</option>
                    <option value="3">Processado</option>
                </select>
            </div>
            <div id="order-sum">Total: R$ 0,00</div>


            <form id="uploadForm" enctype="multipart/form-data" method="POST">
                <input type="file" name="file" />
                <button type="submit">Upload status do pedido</button>
              </form>
        </div>



        <div id="orders-container">
            <!-- Orders will be inserted here dynamically -->
        </div>
    </div>

    <div id="order-modal" class="modal">
        <div class="modal-content">
            <div class="order-header">
                <div class="order-info">
                    <div class="order-info-row">
                        <span>Numero do Pedido:</span>
                        <span id="order-id"></span>
                    </div>
                    <div class="order-info-row">
                        <span>Razao Social:</span>
                        <span id="razao-social"></span>
                    </div>
                    <div class="order-info-row">
                        <span>CNPJ:</span>
                        <span id="cnpj"></span>
                    </div>
                    <div class="order-info-row">
                        <span>Email:</span>
                        <span id="email"></span>
                    </div>
                    <div class="order-info-row">
                        <span>Representante:</span>
                        <span id="representante"></span>
                    </div>
                    <div class="order-info-row">
                        <span>Situação:</span>
                        <span id="situacao"></span>
                    </div>
                </div>
                <img src="/imagens/LOGO_NYR.png" alt="Logo" id="logo-image">
            </div>

            <table id="order-items-table">
                <thead>
                    <tr>
                        <th>-</th> 
                        <th>Imagem</th> 
                        <th>Código</th>
                        <th>Descrição</th>
                        <th>Qtde</th>
                        <th>Preço Unitário</th>
                        <th>Ipi</th>
                        <th>Subtotal</th>
                        <th>Editar</th>
                        <th>Apagar</th>
                    </tr>
                    <div class="topButtons">
                        <div class="container">
                            <div class="switch-container">
                                <span class="switch-label left-label active">Aberto</span>
                                <label class="switch">
                                    <input type="checkbox" id="toggleButton">
                                    <span class="slider"></span>
                                </label>
                                <span class="switch-label right-label">Orçamento</span>
                            </div>
                        </div>
                        <div class="dropdown">
                            <div id="ipilabel">
                                <label for="ipi">IPI:</label>
                                <select id="ipi">
                                    <option value='0'>B0</option>
                                    <option value='0.13'>B1</option>
                                    <option value='0.065'>B2</option>
                                    <option value='0.039'>B3</option>
                                </select>
                            </div>
                        </div>
                        <div class="dropdown">
                            <div id="desclabel">
                                <label for="desc">Desconto:</label>
                                <select id="desc">
                                    <option value='0'>0%</option>
                                    <option value='0.03'>3%</option>
                                    <option value='0.05'>5%</option>
                                    <option value='0.08'>8%</option>
                                    <option value='0.10'>10%</option>
                                </select>
                            </div>               
                        </div>
                    </div>
                </thead>
                <tbody id="order-details-content">
                    <!-- Product rows will be dynamically populated here -->
                </tbody>
            </table>
            <div class="totalOrderBox">
                <div class="order-total">
                    <div>
                        <span class="valores">Valor do pedido:</span>
                        <span id="total-order">R$ 0,00</span>
                    </div>
                    <div>
                        <span class="valores">Valor do ipi:</span>
                        <span id="ipi-order">R$ 0,00</span>
                    </div>
                    <div>
                        <span class="valores">Valor do desconto:</span>
                        <span id="discount-value">R$ 0,00</span>
                    </div>
                    <div>
                        <span class="valores">Total do pedido:</span>
                        <span id="total-value">R$ 0,00</span>
                    </div>
                </div>
            </div>
            <div id="print-info">
                <div>
                    <span id="ipi-display" class="ipi-print-only"></span>
                </div>
                <div>
                    <span id="desc-display" class="desc-print-only"></span>
                </div>
            </div>
            <div class="obs-row">
                <span>Observações:</span>
                <textarea type="text" id="obs" placeholder="Transportadora / Forma de pagamento"></textarea>
            </div>
            <div class="allbtns">
                <div class="modal-actions">
                    <button class="action-btn" onclick="printOrder()">Imprimir</button>
                    <button id="save-notes-btn" class="action-btn">Salvar</button>
                    <button id="duplicateOrderButton" class="action-btn">Duplicar</button>
                    <button id="finish-order-btn" class="action-btn">Finalizar</button>
                    <button id="receive-order-btn" class="action-btn">Receber</button>
                    <button id="revert-order-btn" class="action-btn">Recuperar</button>
                    <button id="delete-order-btn" class="action-btn">Apagar</button>
                </div>
                <button id="close-modal" class="action-btn">Fechar</button>
            </div>
        </div>
    </div>
</div>

<script>
    let allOrders = [];

    // Function to handle login state and display username
    function displayUserName() {
        const username = localStorage.getItem('username');
        if (username) {
            document.getElementById('username-display').textContent = `Bem-vindo, ${username}`;
        }
    }
    
    // Function to handle logout
    function handleLogout() {
        localStorage.removeItem('username');
        window.location.href = '/index.html';
    }
    
    // Event listener for logout button
    document.getElementById('logoutBtn').addEventListener('click', handleLogout);
    
    // Function to load orders from the backend
    async function loadOrders() {
        try {
            const response = await fetch(`${URL_API}/orders-admin`, { method: 'GET' });
            if (!response.ok) {
                document.getElementById('orders-container').innerHTML = '<p>FALHA AO CARREGAR OS PEDIDOS.</p>';
                return;
            }
            allOrders = await response.json();
            filterAndDisplayOrders();
            console.log('CONTEUDO PEDIDO:', allOrders);
        } catch (error) {
            console.error('Error fetching orders:', error);
            document.getElementById('orders-container').innerHTML = '<p>FALHA AO CARREGAR OS PEDIDOS.</p>';
        }
    }
    
    // Function to filter and display orders
    function filterAndDisplayOrders() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
        const statusFilter = document.getElementById('status-filter').value;

        const filteredOrders = allOrders.filter(order => {
            const matchesSearch =
                order.id.toString().includes(searchTerm) ||
                order.representante.toLowerCase().includes(searchTerm) ||
                order.razaosocial.toLowerCase().includes(searchTerm) ||
                new Date(order.data).toLocaleDateString().includes(searchTerm) ||
                (statusMap[order.status]?.text.toLowerCase() || '').includes(searchTerm);
            const matchesStatus = statusFilter === 'all' || order.status.toString() === statusFilter;
            return matchesSearch && matchesStatus;
        });

        displayOrders(filteredOrders);
        updateSum(filteredOrders);
    }

    const statusMap = {
        0: { text: 'Aberto', color: '#E07A5F' },
        1: { text: 'Orçamento', color: '#FFB200' },
        2: { text: 'Fechado', color: '#6EC207' },
        3: { text: 'Processado', color: '#3D8D7A' }
    };

    // Function to dynamically display orders
    function displayOrders(orders) {
        const container = document.getElementById('orders-container');
        container.innerHTML = ''; // Clear existing content

        if (orders.length === 0) {
            container.innerHTML = '<p>Nenhum pedido encontrado.</p>';
            return;
        }

        orders.forEach(order => {
            const total = parseFloat(order.total) || 0;
            const status = statusMap[order.status] || { text: 'Unknown', color: 'gray' };
            
            
            const orderRow = `
    <div class="order-row" data-id="${order.id}">
        <div><strong>ID:</strong> ${order.id}</div>
        <div><strong>Representante:</strong> ${order.representante.toUpperCase()}</div>
        <div><strong>Razão Social:</strong> ${order.razaosocial.toUpperCase()}</div>
        <div><strong>Data:</strong> ${new Date(order.data).toLocaleDateString()}</div>
        <div><strong>Total:</strong> R$ ${total.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
        <div style="color: ${status.color};"><strong>Status: ${status.text} </strong></div>
    </div>
`;

            
            container.innerHTML += orderRow;
        });
    }

    // Function to update the sum of filtered orders
    function updateSum(orders) {
        const totalSum = orders.reduce((sum, order) => sum + (parseFloat(order.total) || 0), 0);
        document.getElementById('order-sum').textContent = `Total: R$ ${totalSum.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
    }
    


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////


    
    // Function to fetch and display order details in the modal
    async function fetchOrderDetails(orderId) {
        console.log("CHECK HERE", orderId);
        try {
            console.log(`Fetching details for order ID: ${orderId}`);
            const response = await fetch(`${URL_API}/order-details/${orderId}`);
            if (!response.ok) {
                throw new Error('Failed to fetch order details');
            }
            const orderDetails = await response.json();
    
            const orderID = orderDetails.id;
            localStorage.setItem('currentOrderId', orderID);
    
            console.log('Order details received:', orderDetails);
            populateModal(orderDetails);
        } catch (error) {
            console.error('Error fetching order details:', error);
        }
    }
    
////////////////////////////////////////////////////////////////////////////////////////////



function populateModal(orderDetails) {
    document.getElementById('order-id').textContent = orderDetails.id;
    document.getElementById('razao-social').textContent = orderDetails.razaosocial;
    document.getElementById('cnpj').textContent = orderDetails.cnpj;
    document.getElementById('email').textContent = orderDetails.email;
    document.getElementById('representante').textContent = orderDetails.representante;
    document.getElementById('obs').textContent = orderDetails.observacoes;
    

    // Fetch situacao (status info) from backend using pedidoweb
    fetch(`${URL_API}/pedidostatus/${orderDetails.id}`)
        .then(response => response.json())
        .then(data => {
            document.getElementById('situacao').textContent = data.status;
        })
        .catch(error => {
            console.error('Erro ao buscar status do pedido:', error);
            document.getElementById('situacao').textContent = 'Status não encontrado';
        });
    
    // Get IPI dropdown and display elements
    const ipiDropdown = document.getElementById('ipi');
    const ipiDisplay = document.getElementById('ipi-display');

    // Set the IPI dropdown value
    if (orderDetails.ipi_tax) {
        ipiDropdown.value = orderDetails.ipi_tax;
    }
  
    // Update products table and calculate total
    ipiDisplay.textContent = "IPI: " + ipiDropdown.options[ipiDropdown.selectedIndex].text;





    const descDropdown = document.getElementById('desc');
    const descDisplay = document.getElementById('desc-display');
   // Select the discount dropdown element
   const discount = document.querySelector('#desc');
    

   if (orderDetails.desconto !== undefined && orderDetails.desconto !== null) {
    descDropdown.value = orderDetails.desconto;
    } else {
        descDropdown.value = 0; // Ensure 0 is set when no discount is provided
    }


     // Set the DESC dropdown value
     //if (orderDetails.desconto) {
      //  descDropdown.value = orderDetails.desconto;}
  
        // Update desc



    descDisplay.textContent = "DESC: " + parseFloat(discount.value)*100 + "%";





    const orderDetailsContent = document.getElementById('order-details-content');
    let total = 0;
    let ipiOrder = 0;

    orderDetailsContent.innerHTML = ''; // Clear previous content

    orderDetails.products.forEach((product, index) => {
        const price = parseFloat(product.preco);
        const quantity = parseInt(product.quantidade, 10);
        const factor = parseFloat(product.ipi);
        const ipiTax = parseFloat(orderDetails.ipi_tax);
        const ipi = factor * ipiTax * price * quantity;
        const productTotal = (price * quantity) + ipi;

        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        }

        const row = `
            <tr data-product-id="${product.id}">
                <td>${index + 1}</td>
                <td><img src="${product.imagem}" alt="Imagem do Produto" class="product-image" style="width:40px;"></td>
                <td>${product.codproduto}</td>
                <td>${product.descricao}</td>
                <td class="quantity">${quantity}</td>
                <td>${formatCurrency(price)}</td>
                <td>${formatCurrency(ipi)}</td>
                <td>${formatCurrency(productTotal)}</td>
                <td><button class="modalOrderEditButton"><img src="/imagens/pencil.png" alt="Editar"></button></td>
                <td><button class="modalOrderDeleteButton"><img src="/imagens/trashcan.png" alt="Apagar"></button></td>
            </tr>
        `;  
    

    orderDetailsContent.innerHTML += row;

    total += productTotal;

            
    ipiOrder += ipi;

    total2 = total - ipiOrder;


    console.log('IPI VALUE:',ipiOrder);

    });




    function updateTotal() {
            let discountValue = parseFloat(discount.value) || 0;
            let discountTotal = total * discountValue * (-1);
            let totalFinal = total * (1 - discountValue);

            function formatCurrency(value) {
                return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
            }
            document.getElementById('ipi-order').textContent = formatCurrency(ipiOrder);
            document.getElementById('total-order').textContent = formatCurrency(total - ipiOrder);
            document.getElementById('discount-value').textContent = formatCurrency(discountTotal);
            document.getElementById('total-value').textContent = formatCurrency(totalFinal);
        }

        updateTotal();
        discount.addEventListener('change', updateTotal);

        const toggleButton = document.getElementById('toggleButton');
        if (toggleButton) {
            if (orderDetails.status === 0) {
                toggleButton.checked = false; 
            } else if (orderDetails.status === 1) {
                toggleButton.checked = true;
            }
        }





/////////////////////////////////////////////////////////////////////////////////////////////////////


        document.querySelectorAll('.modalOrderEditButton').forEach((button) => {
            button.addEventListener('click', async function () {
                const row = this.closest('tr');
                const orderId = localStorage.getItem('currentOrderId');
                const quantityCell = row.querySelector('.quantity');
                const productId = row.getAttribute('data-product-id');
                const currentQuantity = parseInt(quantityCell.textContent.trim(), 10);

                const inputField = document.createElement('input');
                inputField.type = 'number';
                inputField.value = currentQuantity;
                inputField.classList.add('edit-quantity');

                const saveButton = document.createElement('button');
                saveButton.textContent = 'Salvar';
                saveButton.classList.add('save-quantity-btn');

                quantityCell.innerHTML = '';
                quantityCell.appendChild(inputField);
                quantityCell.appendChild(saveButton);
                inputField.focus();

                inputField.addEventListener('keypress', function (event) {
                    if (event.key === 'Enter') saveButton.click();
                });

                saveButton.addEventListener('click', async function () {
                    const newQuantity = parseInt(inputField.value, 10);
                    if (newQuantity && newQuantity > 0) {
                        try {
                            const response = await fetch(`${URL_API}/editproduct-admin/${productId}`, {
                                method: 'PATCH',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ quantity: newQuantity })
                            });

                            if (!response.ok) throw new Error('Failed to update quantity');
                            const data = await response.json();

                            const ipi = data.updatedProduct.ipi;
                            const updatedTotal = data.updatedProduct.total;
                            const cxfechada = data.updatedProduct.cxfechada;
                            const precofechada = data.updatedProduct.precofechada;
                            const precofrac = data.updatedProduct.precofrac;
                            const chosenPrice = (newQuantity >= cxfechada) ? precofechada : precofrac;
                            const ipitax = data.updatedProduct.ipiTax || 0;

                            const ipiValue = ipi * ipitax * chosenPrice * newQuantity;
                            const productTotal = chosenPrice * newQuantity + ipiValue;

                            function formatCurrency(value) {
                                return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
                            }

                            quantityCell.textContent = newQuantity;
                            row.cells[5].textContent = formatCurrency(chosenPrice);
                            row.cells[6].textContent = formatCurrency(ipiValue);
                            row.cells[7].textContent = formatCurrency(productTotal);

                            updateTotalPrice();
                          // window.location.reload();
                        } catch (error) {
                            alert('Error updating quantity');
                            console.error('Error updating quantity:', error);
                        }
                    } else {
                        alert('ADICIONE UMA QUANTIDADE VÁLIDA.');
                    }
                });
            });
        });

        function updateTotalPrice() {
            const rows = document.querySelectorAll('#order-details-content tr');
            let total = 0;
            const discount = document.querySelector('#desc');
            let discountValue = parseFloat(discount.value) || 0;
            
            rows.forEach(row => {
                const productTotal = parseFloat(
                    row.cells[7].textContent
                        .replace('R$', '')
                        .trim()
                        .replace(/\./g, '')
                        .replace(',', '.')
                );
                total += productTotal;
            });

            let discountTotal = total * discountValue;
            let totalFinal = total * (1 - discountValue);

            function formatCurrency(value) {
                return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
            }

            document.getElementById('discount-value').textContent = formatCurrency(discountTotal);
            document.getElementById('total-value').textContent = formatCurrency(totalFinal);
        }

        document.querySelectorAll('.modalOrderDeleteButton').forEach((button) => {
            button.addEventListener('click', async (event) => {
                event.stopPropagation();
                const row = button.closest('tr');
                const productId = row.getAttribute('data-product-id');
                await deleteProduct(productId, orderDetails.id);
            });
        });
    }
    
    // Function to delete a product
    async function deleteProduct(productId, orderId) {
        try {
            const response = await fetch(`${URL_API}/delete-product-admin`, {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ productId, orderId })
            });
    
            if (!response.ok) {
                throw new Error('Failed to delete product');
            }
    
            console.log(`Product with ID ${productId} deleted successfully.`);
            alert('PRODUTO DELETADO COM SUCESSO.');
            fetchOrderDetails(orderId);
        } catch (error) {
            console.error('Error deleting product:', error);
        }
    }
    
    // Event listener for opening the modal
    document.getElementById("orders-container").addEventListener("click", function(event) {
        if (event.target && event.target.closest(".order-row")) {
            const orderRow = event.target.closest(".order-row");
            const orderId = orderRow.getAttribute("data-id");
            fetchOrderDetails(orderId);
            document.getElementById("order-modal").style.display = "block";
        }
    });
    
    // Event listener for closing the modal
    document.getElementById("close-modal").addEventListener("click", function() {
        document.getElementById("order-modal").style.display = "none";
    });
    
    // Close modal when clicking outside
    window.addEventListener("click", function(event) {
        const modal = document.getElementById("order-modal");
        if (event.target === modal) {
            modal.style.display = "none";
        }
    });
    
    // Event listeners for filtering
    document.getElementById('searchInput').addEventListener('input', filterAndDisplayOrders);
    document.getElementById('status-filter').addEventListener('change', filterAndDisplayOrders);
    
    // Load orders and user info when page loads
    window.onload = function() {
        loadOrders();
        displayUserName();
    };
    
    const textarea = document.getElementById('obs');
    textarea.addEventListener('input', () => {
        textarea.style.height = 'auto';
        textarea.style.height = `${textarea.scrollHeight}px`;
    });
    
    // Save Notes Button
    document.getElementById("save-notes-btn").addEventListener("click", async () => {
        const observation = document.getElementById("obs").value.trim();
        const orderId = localStorage.getItem('currentOrderId');
    
        if (!orderId) {
            alert("No draft order found to save notes.");
            return;
        }
    
        const requestData = {
            orderId: orderId,
            observation: observation,
        };
    
        console.log('REQ DADOS:', requestData);
    
        try {
            const response = await fetch(`${URL_API}/save-notes`, {
                method: "PATCH",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(requestData),
            });

            if (response.ok) {
                alert('PEDIDO SALVO COM SUCESSO!');
            } else {
                console.error("Falha ao salvar pedido.");
                alert('Ocorreu um erro, tente novamente.');
            }
        } catch (error) {
            console.error("Erro:", error);
        }
    });
    
    // Delete Order Button
    document.getElementById("delete-order-btn").addEventListener("click", async () => {
        const orderId = localStorage.getItem('currentOrderId');
    
        const confirmDelete = confirm("TEM CERTEZA QUE DESEJA APAGAR ESTE PEDIDO? ESTA AÇÃO NÃO PODERÁ SER DESFEITA.");
        if (!confirmDelete) {
            return;
        }
    
        const requestData = { orderId: orderId };
    
        try {
            const response = await fetch(`${URL_API}/delete-order`, {
                method: "DELETE",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(requestData),
            });
    
            if (response.ok) {
                alert('PEDIDO DELETADO COM SUCESSO!');
                window.location.reload();
            } else {
                console.error("Falha ao deletar o pedido.");
                alert('An error occurred. Please try again later.');
            }
        } catch (error) {
            console.error("Error submitting the order:", error);
        }
    });
    
    function printOrder() {
        const modalClone = document.querySelector('#order-modal').cloneNode(true);
        const ipiDropdown = modalClone.querySelector('#ipi');
        if (ipiDropdown) {
            const selectedIpiText = ipiDropdown.options[ipiDropdown.selectedIndex].text;
            const ipiTextElement = document.createElement('span');
            ipiTextElement.textContent = selectedIpiText;
            ipiDropdown.replaceWith(ipiTextElement);
        }

        const printWindow = window.open('', '', 'width=800,height=600');
        printWindow.document.write('<html><head><title>Print Order</title>');
        printWindow.document.write('<style>');
        printWindow.document.write(`
            @media print {
                body {
                    font-family: Arial, sans-serif;
                    font-size: 12pt;
                    line-height: 1.5;
                    position: relative;
                    margin: 0;
                    padding-top: 60px;
                    padding-bottom: 60px;
                }
                .header {
                    position: absolute;
                    top: 10px;
                    left: 0;
                    right: 0;
                    text-align: center;
                    font-size: 16pt;
                    font-weight: bold;
                    border-bottom: 2px solid #000;
                    padding-bottom: 10px;
                }
                .footer {
                    position: absolute;
                    bottom: 10px;
                    left: 0;
                    right: 0;
                    text-align: center;
                    font-size: 10pt;
                    color: #555;
                    border-top: 1px solid #ddd;
                    padding-top: 10px;
                }
                #logo-image,
                #ipilabel,
                #desclabel,
                #order-items-table th:nth-child(9),
                #order-items-table td:nth-child(9),
                #order-items-table th:nth-child(10),
                #order-items-table td:nth-child(10),
                .allbtns,
                #submit-order-btn,
                #delete-order-btn,
                #close-modal {
                    display: none !important;
                }
                #order-items-table {
                    border-collapse: collapse;
                    width: 100%;
                    margin-top: 20px;
                    page-break-inside: auto;
                }




                #order-items-table th, #order-items-table td {
                    padding: 8px;
                    text-align: center;
                    vertical-align: middle;
                    border: 1px solid #ddd;
                }
               

                .totalOrderBox {
                    margin-top: 20px;
                    font-size: 14pt;
                    font-weight: bold;
                    border-top: 2px solid #000;
                    padding-top: 10px;
                    page-break-inside: avoid;
                }
                .obs-row {
                    font-size: 11pt;
                    margin-top: 20px;
                    padding: 10px;
                    background-color: #f9f9f9;
                    page-break-inside: avoid;
                }
                .obs-row textarea {
                    width: 100%;
                    font-size: 11pt;
                    border: 1px solid #ddd;
                    padding: 5px;
                    box-sizing: border-box;
                    resize: none;
                    white-space: pre-wrap;
                    overflow: visible;
                    min-height: 160px;
                    height: auto !important;
                }
                .order-header {
                    margin-bottom: 20px;
                    page-break-inside: avoid;
                }
                .order-info-row span {
                    font-weight: bold;
                }
                table {
                    font-size: 10pt;
                }
                .order-info, .order-total {
                    page-break-after: auto;
                }
                #order-items-table th:nth-child(2), #order-items-table td:nth-child(2) {
                width: 15%;
            }

            #order-items-table th:nth-child(3), #order-items-table td:nth-child(3) {
                width: 10%;
            }

            #order-items-table th:nth-child(4), #order-items-table td:nth-child(4) {
                width: 40%;
            }

            #order-items-table th:nth-child(5), #order-items-table td:nth-child(5) {
                width: 10%;
            }

            #order-items-table th:nth-child(6), #order-items-table td:nth-child(6) {
                width: 15%;
            }
             #order-items-table th:nth-child(7), #order-items-table td:nth-child(7) {
                    width: 15%;
                }
                        #order-items-table th:nth-child(8), #order-items-table td:nth-child(8) {
                    width: 20%;
                }
                .switch-container {
                    display: none;
                }
            }
        `);
        printWindow.document.write('</style></head><body>');
        printWindow.document.write('<div class="header">NYR Festas</div>');
        printWindow.document.write(modalClone.outerHTML);
        printWindow.document.close();
        printWindow.print();
    }
    
    document.getElementById("toggleButton").addEventListener("change", async (event) => {
        const orderId = localStorage.getItem('currentOrderId');
        const observation = document.getElementById("obs").value.trim();
        console.log('toggleButton clicked by ADMIN');
    
        if (!orderId) {
            alert('Order ID is missing. Please try again.');
            return;
        }
    
        try {
            const response = await fetch(`${URL_API}/orderStatus`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ orderId }),
            });
    
            const data = await response.json();
            if (!data || data.status === undefined) {
                console.error("Invalid response:", data);
                return;
            }
    
            const currentStatus = data.status;
    
            if (currentStatus === 0) {
                const submitResponse = await fetch(`${URL_API}/submit-order`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ orderId, observation }),
                });
    
                if (submitResponse.ok) {
                    alert('PEDIDO FOI ENVIADO PARA ORÇAMENTO COM SUCESSO!');
                    window.location.reload();
                } else {
                    alert('Ocorreu um erro ao enviar o pedido.');
                    event.target.checked = false;
                }
            } else if (currentStatus === 1) {
                const checkResponse = await fetch(`${URL_API}/checkOtherOpenedOrders`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username: localStorage.getItem('username') }),
                });
    
                const checkData = await checkResponse.json();
                if (checkData && checkData.canRevert) {
                    await fetch(`${URL_API}/revertOrder`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ orderId }),
                    });
                    alert("STATUS DA ORDEM REVERTIDO PARA 'ABERTO' COM SUCESSO!");
                    window.location.reload();
                } else {
                    alert("O STATUS NÃO PODE SER REVERTIDO NO MOMENTO, EXISTE OUTRA ORDEM EM 'ABERTO.'");
                    event.target.checked = false;
                }
            } else if (currentStatus === 2) {
                alert("O STATUS NÃO PODE SER ALTERADO, A ORDEM JÁ ESTÁ FECHADA.");
                event.target.checked = false;
            }
        } catch (error) {
            console.error("Error:", error);
            alert("Ocorreu um erro ao processar a solicitação.");
            event.target.checked = false;
        }
    });
    
    document.getElementById("revert-order-btn").addEventListener("click", async () => {
        const orderId = localStorage.getItem('currentOrderId');
        const observation = document.getElementById("obs").value.trim();
        console.log('finalizar botao apertado!');
    
        if (!orderId) {
            alert('Order ID is missing. Please try again.');
            return;
        }
    
        try {
            const response = await fetch(`${URL_API}/orderStatus`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ orderId }),
            });
    
            const data = await response.json();
            if (!data || data.status === undefined) {
                console.error("Invalid response:", data);
                return;
            }
    
            const currentStatus = data.status;
    
            if (currentStatus === 2 || currentStatus === 3) {
                const finishResponse = await fetch(`${URL_API}/revertOrderadmin`, {
                    method: "PATCH",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ orderId, observation }),
                });
    
                if (finishResponse.ok) {
                    alert('PEDIDO RECUPERADO!');
                } else {
                    alert('OCORREU UM ERRO.');
                }
            } else {
                alert('PEDIDO JÁ ESTÁ ABERTO OU EM ORÇAMENTO.');
            }
        } catch (error) {
            console.error("Error:", error);
            alert("OCORREU UM ERRO.");
        }
        window.location.reload();
    });
    
    document.getElementById("receive-order-btn").addEventListener("click", async () => {
        const orderId = localStorage.getItem('currentOrderId');
        if (!orderId) {
            alert("No order ID found.");
            return;
        }
    
        console.log('Finalizar botão apertado!', orderId);
    
        try {
            const finishResponse = await fetch(`${URL_API}/receiveOrder`, {
                method: "PATCH",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ orderId: Number(orderId) }),
            });
    
            if (!finishResponse.ok) {
                throw new Error(`Failed to finish order: ${finishResponse.status}`);
            }
            alert('PEDIDO RECEBIDO COM SUCESSO!');
            window.location.reload();
        } catch (error) {
            console.error("Error finishing order:", error);
            alert("Erro ao finalizar pedido. Tente novamente!");
        }
    });
    
    document.getElementById("finish-order-btn").addEventListener("click", async () => {
        const orderId = localStorage.getItem('currentOrderId');
        const observation = document.getElementById("obs").value.trim();
        console.log('finalizar botao apertado!');
    
        if (!orderId) {
            alert('Order ID is missing. Please try again.');
            return;
        }
    
        if (!observation) {
            alert('FAVOR INSERIR DADOS DE TRANSPORTADORA E FORMA DE PAGAMENTO NO CAMPO "OBSERVAÇÕES"');
            return;
        }
    
        const userConfirmed = window.confirm('TEM CERTEZA QUE DESEJA FINALIZAR ESTE PEDIDO? ESTA AÇÃO É IRREVERSÍVEL.');
        if (!userConfirmed) {
            return;
        }
    
        try {
            const response = await fetch(`${URL_API}/orderStatus`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ orderId }),
            });
    
            const data = await response.json();
            if (!data || data.status === undefined) {
                console.error("Invalid response:", data);
                return;
            }
    
            const currentStatus = data.status;
    
            if (currentStatus === 0 || currentStatus === 1) {
                const finishResponse = await fetch(`${URL_API}/finishOrder`, {
                    method: "PATCH",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ orderId, observation }),
                });
    
                if (finishResponse.ok) {
                    alert('PEDIDO FINALIZADO COM SUCESSO!');
                } else {
                    alert('OCORREU UM ERRO.');
                }
            } else {
                alert('O PEDIDO JÁ FOI FINALIZADO.');
            }
        } catch (error) {
            console.error("Error:", error);
            alert("OCORREU UM ERRO.");
        }
        window.location.reload();
    });
    
    document.getElementById("desc").addEventListener("change", async function () {
        const discount = parseFloat(this.value);
        const orderId = localStorage.getItem('currentOrderId');
    
        try {
            const response = await fetch(`${URL_API}/update-desc-admin`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ orderId, discount })
            });
    console.log('DESCONTO', response);

            const data = await response.json();
            if (response.ok) {
                alert(`Aplicado desconto de ${discount * 100}%`);
            } else {
                alert("Não é possível aplicar o desconto, pedido com status FECHADO.");
            }
        } catch (error) {
            console.error("Erro ao atualizar IPI:", error);
            alert("Erro de conexão com o servidor.");
        }
        window.location.reload();
    });
    
    document.getElementById("ipi").addEventListener("change", async function () {
        const newIPI = parseFloat(this.value);
        const orderId = localStorage.getItem('currentOrderId');
    
        try {
            const response = await fetch(`${URL_API}/update-ipi-admin`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ orderId, newIPI })
            });
    
            const data = await response.json();
            if (response.ok) {
                alert(`IPI atualizado para ${newIPI * 100}%`);
            } else {
                alert("Não é possível atualizar o IPI, pedido com status FECHADO.");
            }
        } catch (error) {
            console.error("Erro ao atualizar IPI:", error);
            alert("Erro de conexão com o servidor.");
        }
        window.location.reload();
    });
    
    // Function to duplicate the order
    async function duplicateOrder() {
        const username = localStorage.getItem('username');
        const newCustomerId = localStorage.getItem('customerId');
        const currentOrderId = localStorage.getItem('currentOrderId');

        if (!username || !newCustomerId || !currentOrderId) {
            console.error('Dados necessários não encontrados no localStorage.');
            alert('SELECIONE UM CLIENTE NA PÁGINA DE CADASTRO.');
            return;
        }

        const requestData = {
            username,
            newCustomerId: parseInt(newCustomerId, 10),
            currentOrderId: parseInt(currentOrderId, 10)
        };

        try {
            const response = await fetch(`${URL_API}/duplicate-order`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestData),
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Erro ao duplicar o pedido.');
            }

            const result = await response.json();
            console.log(result.message);
            alert('PEDIDO: ' + currentOrderId + ' DUPLICADO COM SUCESSO!');
            window.location.reload();
        } catch (error) {
            console.error('Erro:', error.message);
        }
    }

    document.getElementById('duplicateOrderButton').addEventListener('click', duplicateOrder);

    // Function to load customer name based on customerId in localStorage
    function loadCustomerName() {
        const customerId = localStorage.getItem('customerId');
        console.log(customerId);

        if (!customerId) {
            console.error('Customer ID not found in localStorage!');
            document.getElementById('customerName').textContent = 'Nenhum cliente selecionado';
            return;
        }

        fetch(`${URL_API}/displayName`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ customerId })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            const customerName = data.razaosocial || 'Unknown';
            document.getElementById('customerName').textContent = `Cliente: ${customerName}`;
        })
        .catch(error => {
            console.error('Error fetching customer name:', error);
            document.getElementById('customerName').textContent = 'SELECIONE UM CLIENTE E TENTE NOVAMENTE.';
        });
    }

    // Function to clear the customer selection
    function clearCustomer() {
        localStorage.removeItem('customerId');
        document.getElementById('customerName').textContent = 'Nenhum cliente selecionado';
    }

///////////////////////////////////////////////////////////////////////////////////////////







const form = document.getElementById('uploadForm');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  console.log('Submitting to:', URL_API);

  const formData = new FormData(form);

  try {
    const response = await fetch(`${URL_API}/upload`, {
      method: 'POST',
      body: formData,
    });

    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status} ${response.statusText}`);
    }

    const result = await response.json();
    alert(result.message || 'Upload realizado com sucesso!');
  } catch (error) {
    console.error('Upload error:', error);
    alert(`Erro ao enviar o arquivo: ${error.message}`);
  }
});






/*



  const form = document.getElementById('uploadForm');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(form);

    try {
      const response = await fetch(`${URL_API}/upload`, {
        method: 'POST',
        body: formData,
      });

      const result = await response.json();
      alert(result.message || 'Upload realizado com sucesso!');
    } catch (error) {
      console.error(error);
      alert('Erro ao enviar o arquivo.');
    }
  });
  */


    // Call the function when the page loads
    loadCustomerName();

    
</script>

<script src="script.js"></script>
<footer>
    <p>© 2025 | NYR Festas</p>
</footer>
</body>
</html>